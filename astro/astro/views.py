from django.shortcuts import render, redirect
from django.http import HttpResponse


data = {'planets': [
            {'name': 'Меркурий', 'id': 1, 
             'description': 'Мерку́рий — наименьшая планета Солнечной системы и самая близкая к Солнцу.', 
             'img': 'http://localhost:9000/images/mercury.jpg',
             'detImg': 'http://localhost:9000/images/detImgs/mercury.jpg',
             'detDes': 'Видимое расстояние Меркурия от Солнца, если смотреть с Земли, никогда не превышает 28°. Эта близость к Солнцу означает, '
                        'что планету можно увидеть только в течение небольшого времени после захода или до восхода солнца, обычно в сумерках. В телескоп у Меркурия можно увидеть фазы, изменяющиеся от тонкого серпа '
                        'до почти полного диска, как у Венеры и Луны, а иногда он проходит по диску Солнца. Период изменения фаз Меркурия равен синодическому периоду его обращения — примерно 116 дней.'},

            {'name': 'Венера', 'id': 2, 
             'description': 'Вене́ра — вторая по удалённости от Солнца и шестая по размеру планета Солнечной системы, наряду с Меркурием, Землёй и Марсом принадлежащая к семейству планет земной группы.', 
             'img': 'http://localhost:9000/images/venus.jpg',
             'detImg': 'http://localhost:9000/images/detImgs/venus.jpg',
             'detDes': 'Названа в честь древнеримской богини любви Венеры. По ряду характеристик — например, по массе и размерам — Венера считается «сестрой» Земли. Венерианский год составляет 224,7 земных суток. '
                        'Она имеет самый длинный период вращения вокруг своей оси (около 243 земных суток, в среднем 243,0212 ± 0,00006 сут) среди всех планет Солнечной системы и вращается в направлении, противоположном направлению '
                        'вращения большинства планет. Венера не имеет естественных спутников. На земном небе Венера является третьим по яркости светилом после Солнца и Луны. Её яркость достигает видимой звёздной величины −4,6m и '
                        'является достаточной, чтобы ночью отбрасывать различимые тени. Изредка Венера видна невооружённым глазом и в светлое время суток.'},

            {'name': 'Юпитер', 'id': 3, 
             'description': 'Юпи́тер — крупнейшая планета Солнечной системы, пятая по удалённости от Солнца. ', 
             'img': 'http://localhost:9000/images/jupiter.jpg',
             'detImg': 'http://localhost:9000/images/detImgs/jupiter.jpg',
             'detDes': 'Планета была известна людям с глубокой древности, что нашло своё отражение в мифологии и религиозных верованиях различных культур: месопотамской, вавилонской, греческой и других. Современное название Юпитера '
                        'происходит от имени древнеримского верховного бога-громовержца.Ряд атмосферных явлений на Юпитере — штормы, молнии, имеет масштабы, на порядки превосходящие земные. Примечательным образованием в атмосфере является Большое '
                        'красное пятно — гигантский шторм, известный с XVII века.'},

            {'name': 'Марс', 'id': 4, 
             'description': 'Марс — четвёртая по удалённости от Солнца и седьмая по размеру планета Солнечной системы. Наряду с Меркурием, Венерой и Землёй принадлежит к семейству планет земной группы.', 
             'img': 'http://localhost:9000/images/mars.jpg',
             'detImg': 'http://localhost:9000/images/detImgs/mars.jpg',
             'detDes': 'Марс хорошо виден с Земли невооружённым глазом. Его видимая звёздная величина достигает -2,94m (при максимальном сближении с Землёй). Марс уступает по яркости лишь Юпитеру (во время великого противостояния Марса он может превзойти Юпитер), Венере, Луне и Солнцу. Противостояние Марса можно наблюдать каждые два года.'
                       'У Марса есть два естественных спутника — Фобос и Деймос (в переводе с древнегреческого — «страх» и «ужас», имена двух сыновей Ареса, сопровождавших его в бою), которые относительно малы (Фобос — 26,8x22,4x18,4 км, Деймос — 15x12,2x10,4 км) и имеют неправильную форму.'
                       'Масса планеты составляет 10,7 % массы Земли, а по линейному размеру она практически ровно вдвое меньше Земли. Год на Марсе длится 687 земных суток, или около 669 марсианских солнечных суток (солов). На Марсе происходит смена времён года, аналогичная земной, но вытянутость его орбиты приводит к большим различиям в продолжительности сезонов.'},

            {'name': 'Сатурн', 'id': 5, 
             'description': 'Сату́рн — шестая планета по удалённости от Солнца и вторая по размерам планета в Солнечной системе после Юпитера.', 
             'img': 'http://localhost:9000/images/saturn.jpg',
             'detImg': 'http://localhost:9000/images/detImgs/saturn.png',
             'detDes': 'В основном Сатурн состоит из водорода, с примесями гелия и следами воды, метана, аммиака и тяжёлых элементов. Внутренняя область представляет собой относительно небольшое ядро из железа, никеля и льда, покрытое '
                        'тонким слоем металлического водорода и газообразным внешним слоем. Внешняя атмосфера планеты кажется из космоса спокойной и однородной, хотя иногда на ней появляются долговременные образования. Скорость ветра на Сатурне '
                        'может достигать местами 1800 км/ч, что значительно больше, чем на Юпитере.'},

            {'name': 'Нептун', 'id': 6, 
             'description': 'Непту́н — восьмая и самая дальняя от Солнца планета Солнечной системы. ', 
             'img': 'http://localhost:9000/images/neptune.jpg',
             'detImg': 'http://localhost:9000/images/detImgs/neptune.png',
             'detDes': 'Обнаружен 23 сентября 1846 года, став первой планетой, открытой благодаря математическим расчётам. Обнаружение непредсказуемых изменений орбиты Урана породило гипотезу о неизвестной планете, гравитационным '
                        'возмущающим влиянием которой они и обусловлены. Нептун был найден в пределах предсказанной орбиты. Вскоре был открыт его крупнейший спутник Тритон, а в 1949 году — Нереида. Нептун посещался лишь одним космическим аппаратом, '
                        '«Вояджером-2», который пролетел вблизи планеты 24—25 августа 1989 года. С его помощью были открыты кольца Нептуна и 6 его спутников. Остальные известные спутники Нептуна открыты в XXI веке.'},

            {'name': 'Уран', 'id': 7, 
             'description': 'Ура́н — планета Солнечной системы, седьмая по удалённости от Солнца, третья по диаметру и четвёртая по массе. ', 
             'img': 'http://localhost:9000/images/uranus.jpg',
             'detImg': 'http://localhost:9000/images/detImgs/uranus.png',
             'detDes': 'Уран стал первой планетой, обнаруженной в Новое время и при помощи телескопа. Его открыл Уильям Гершель 13 марта 1781 года, тем самым впервые со времён античности '
                        'расширив границы Солнечной системы в глазах человека. Несмотря на то, что порой Уран различим невооружённым глазом, более ранние наблюдатели принимали его за тусклую звезду.'}
        ],
        'orders': [{'id': 1, 'planets': [1, 4, 3]}, 
                   {'id': 2, 'planets': []}, 
                   {'id': 3, 'planets': [1, 7, 6, 2]}],
        'curOrderId': '1',
        'searchText': '',
        'searchResult': [],}

def idToPlanets(idList):
    result = []
    for planet in data['planets']:
        if planet['id'] in idList:
            result.append(planet)
    return result

def findWishList(id_of_wish):
    resultId = []
    for order in data['orders']:
        if id_of_wish == order['id']:
            resultId = order['planets']
    return resultId

def getServices(request):
    data['searchText'] = request.GET.get('text', '')
    data['searchResult'].clear()
    for planet in data['planets']:
        if data['searchText'].lower() in planet['name'].lower():
            data['searchResult'].append(planet)
    
    list = findWishList(int(data['curOrderId']))
    if data['searchText'] == '':
        return render(request, 'orders.html', {'data': data, 'planets': data['planets'], 'wishCount': len(list), 'action': 'Добавить'})
    return render(request, 'orders.html', {'data': data, 'planets': data['searchResult'], 'wishCount': len(list), 'action': 'Добавить'})

def getPlanet(request, planet_id):
    return render(request, 'order.html', {'planet': data['planets'][planet_id-1]})

def getWishList(request, wish_id):
    return render(request, 'wish_list.html', {'wish': idToPlanets(findWishList(wish_id)), 'action': 'Удалить'})

def search(request):
    data['searchResult'].clear()
    text = request.POST['text']
    data['searchText'] = text
    data['isSearch'] = True
    for planet in data['planets']:
        if text.lower() in planet['name'].lower():
            data['searchResult'].append(planet)
    return redirect('home')

